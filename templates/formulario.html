<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Den칰ncias - Vigiagua</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background:#f4f6f8;
      margin:0;
      padding:20px;
    }

    .wrap {
      max-width:1100px;
      margin:0 auto;
    }

    header {
      text-align:center;
      background:#004d66;
      color:#fff;
      padding:16px;
      border-radius:8px;
    }

    h1 {
      text-align:center;
      color:#004d66;
      margin:18px 0;
    }

    .tabs {
      display:flex;
      gap:8px;
      justify-content:center;
      margin-bottom:18px;
    }

    .tab {
      padding:10px 18px;
      background:#e0e0e0;
      border-radius:8px;
      text-decoration:none;
      color:#333;
      font-weight:600;
    }

    .tab.active {
      background:#004d66;
      color:#fff;
    }

    .card {
      background:#fff;
      padding:20px;
      border-radius:10px;
      box-shadow:0 2px 10px rgba(0,0,0,0.06);
      max-width:600px;           /* 游댳 Largura m치xima reduzida */
      margin:0 auto;             /* 游댳 Centraliza o formul치rio */
    }

    label {
      display:block;
      margin-top:12px;
      font-weight:600;
    }

    input, select, textarea, button {
      width:100%;
      padding:10px;
      margin-top:6px;
      border:1px solid #ccc;
      border-radius:8px;
      box-sizing:border-box;
    }

    button {
      background:#0078d7;
      color:#fff;
      border:none;
      font-weight:700;
      cursor:pointer;
    }

    .flash {
      max-width:900px;
      margin:14px auto;
      padding:12px;
      border-radius:8px;
      font-weight:700;
      text-align:center;
    }

    .flash.sucesso {
      background:#d1e7dd;
      color:#0f5132;
      border:1px solid #badbcc;
    }

    .flash.erro {
      background:#f8d7da;
      color:#721c24;
      border:1px solid #f5c2c7;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
    }

    th, td {
      padding:10px;
      border-bottom:1px solid #eee;
      text-align:left;
      font-size:14px;
    }

    th {
      background:#004d66;
      color:#fff;
    }

    .btn-excluir {
      background:#dc3545;
      color:#fff;
      border:none;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
    }

    .small { width:auto; display:inline-block; }
    .actions { display:flex; gap:8px; align-items:center; }
    .hint { font-size:13px; color:#666; margin-top:6px; }

    .top-actions {
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-bottom:10px;
    }

    .export {
      background:#555;
      color:#fff;
      padding:8px 12px;
      border-radius:8px;
      text-decoration:none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h2 style="margin:0;">VIGIAGUA</h2>
      <small>Registro de Den칰ncias</small>
    </header>

    <div style="text-align:center; margin-top:14px;">
      <a class="tab {{ 'active' if aba == 'denuncias' else '' }}" href="{{ url_for('index', aba='denuncias') }}">Den칰ncias</a>
      <a class="tab {{ 'active' if aba == 'historico' else '' }}" href="{{ url_for('index', aba='historico') }}">Hist칩rico</a>
    </div>

    {% with mensagens = get_flashed_messages(with_categories=true) %}
      {% if mensagens %}
        {% for categoria, msg in mensagens %}
          <div class="flash {{ categoria }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- ABA: Den칰ncias -->
    {% if aba == 'denuncias' %}
      <div class="card">
        <h1 style="font-size:18px;margin:0 0 10px 0">Registrar Den칰ncia</h1>
        <form method="POST" action="{{ url_for('index') }}">
          <label>Denunciante *</label>
          <input name="denunciante" required>

          <label>E-mail</label>
          <input name="email" type="email">

          <label>Telefone</label>
          <input name="telefone">

          <label>Tipo de Den칰ncia *</label>
          <select id="tipo" name="tipo" required>
            <option value="">Selecione</option>
            <option>Qualidade da 츼gua</option>
            <option>Abastecimento</option>
            <option>Rede / Vazamento</option>
            <option>Outros</option>
          </select>

          <div id="qualidadeBox" style="display:none;">
            <label>Tipo de Problema</label>
            <select id="tipo_problema" name="tipo_problema">
              <option value="">Selecione</option>
              <option>Cor Anormal</option>
              <option>Odor Estranho</option>
              <option>Sabor Incomum</option>
              <option>Presen칞a de Subst칙ncias Estranhas</option>
              <option>Espuma ou Res칤duos</option>
              <option>Outros</option>
            </select>
            <div id="outroBox" style="display:none;">
              <label>Descreva (outros)</label>
              <input name="outro_problema" id="outro_problema">
            </div>
          </div>

          <label>Local *</label>
          <input name="local" required>

          <label>Endere칞o *</label>
          <input name="endereco" required>

          <label>Descri칞칚o</label>
          <textarea name="descricao" rows="3"></textarea>

          <div style="margin-top:10px;">
            <button type="submit">Registrar</button>
          </div>
        </form>
      </div>
    {% endif %}

    <!-- ABA: Hist칩rico -->
    {% if aba == 'historico' %}
      <div class="card" style="max-width:900px;">
        <div class="top-actions">
          <a class="export" href="{{ url_for('exportar_pdf') }}">Exportar PDF</a>
        </div>

        <h1 style="font-size:18px;margin:0 0 10px 0">Hist칩rico</h1>

        {% if historico and historico|length > 0 %}
          <table>
            <thead>
              <tr>
                <th>Protocolo</th><th>Data</th><th>Denunciante</th><th>Tipo</th><th>Problema</th><th>Local</th><th>A칞칫es</th>
              </tr>
            </thead>
            <tbody>
              {% for item in historico|reverse %}
                <tr>
                  <td>{{ item["N췈 Protocolo"] }}</td>
                  <td>{{ item["Data Den칰ncia"] }}</td>
                  <td>{{ item["Denunciante"] }}</td>
                  <td>{{ item["Tipo Den칰ncia"] }}</td>
                  <td>{{ item.get("Tipo Problema","") }}</td>
                  <td>{{ item["Local"] }}</td>
                  <td>
                    <form method="POST" action="{{ url_for('excluir') }}" style="display:flex; gap:6px; align-items:center;">
                      <input type="hidden" name="protocolo" value="{{ item['N췈 Protocolo'] }}">
                      <input type="password" name="senha" placeholder="Senha" required class="small">
                      <button class="btn-excluir" type="submit">Excluir</button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="hint">Nenhuma den칰ncia encontrada.</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <script>
    const tipo = document.getElementById('tipo');
    const qualidadeBox = document.getElementById('qualidadeBox');
    const tipoProblema = document.getElementById('tipo_problema');
    const outroBox = document.getElementById('outroBox');

    if (tipo) {
      tipo.addEventListener('change', () => {
        if (tipo.value === 'Qualidade da 츼gua') {
          qualidadeBox.style.display = 'block';
        } else {
          qualidadeBox.style.display = 'none';
          outroBox.style.display = 'none';
          if (tipoProblema) tipoProblema.value = '';
        }
      });
    }

    if (tipoProblema) {
      tipoProblema.addEventListener('change', () => {
        if (tipoProblema.value === 'Outros') {
          outroBox.style.display = 'block';
        } else {
          outroBox.style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>

